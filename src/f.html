<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<iframe class="site" src="https://tick-show.vercel.app/event/383"  frameborder="0" scrolling="no"></iframe>

<script type="text/javascript">


    window.addEventListener('load', function(){
        window.addEventListener('message', (e) => {
            if (typeof e.data !== 'string') return;
            const data = JSON.parse(e.data);

            if (data.type === 'submit') {
                const parsedData = JSON.parse(data.products)
                console.log(parsedData)
                parsedData.forEach((product) => {
                    tcart__addProduct(product);
                })

                setTimeout(() => {
                    tcart__closeCart();
                }, 10);

                const form  = document.querySelector('#form771596234');
                console.log(form);
                const fd = data.data;
                console.log(data,fd)
                for (const key in fd) {
                    console.log(form.querySelector(`[name=${key}]`))
                    form.querySelector(`[name=${key}]`).value = fd[key]
                }

                //form.querySelector('[type=submit]').click();
            }
        })
    });

</script>


<script src="https://js.stripe.com/v3/"></script>
<button id="checkout-button">Pay with Stripe</button>

<script>
    const stripe = Stripe('pk_test_51NFzPbGs1IqP0fLR2HVBFFk52S4iHb7VYsJGV3Lp5KObzTlAnFZASaUdciFdhmnoWmn5LhZ63NIdapIKL1zn9gPK0043sjPcXh');
    const checkoutButton = document.getElementById('checkout-button');
    var line_items_format = []
    for(var i=0;i<)

        checkoutButton.addEventListener('click', async () => {
            const { error } = await stripe.redirectToCheckout({
                lineItems: [{ price: '12', quantity: 1 }],
                mode: 'payment',
                successUrl: window.location.origin + '/success.html',
                cancelUrl: window.location.origin + '/cancel.html',
            });

            if (error) {
                console.error('Error:', error);
            }
        });
    /*
        const socket = new WebSocket('ws://localhost:3000');
        socket.onmessage = (event) => {
          const message = JSON.parse(event.data);
          if (message.type === 'payment_intent.succeeded') {
            alert('Payment successful! Order ID: ' + message.data.metadata.order_id);
          }
        };
        */
</script>


<script type="text/javascript">


    window.addEventListener('load', function(){
        window.addEventListener('message', (e) => {
            const stripe = Stripe('pk_test_51NFzPbGs1IqP0fLR2HVBFFk52S4iHb7VYsJGV3Lp5KObzTlAnFZASaUdciFdhmnoWmn5LhZ63NIdapIKL1zn9gPK0043sjPcXh');
            var line_items_format = []
            if (typeof e.data !== 'string') return;
            const data = JSON.parse(e.data);

            if (data.type === 'submit') {
                const parsedData = JSON.parse(data.products)
                console.log(parsedData)
                parsedData.forEach((product) => {
                    line_items_format.push({
                        'price_data': {
                            'currency': "EUR",
                            'unit_amount': product.price,
                            "product_data": {
                                "name": product.name,
                            },
                        },
                        quantity: 1
                    })
                })
                if (error) {
                    console.error('Error:', error);
                }
            }
        })
    });

</script>
</body>
</html>